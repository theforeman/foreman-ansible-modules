---
- name: "find content view versions of {{ cv.name }}"
  theforeman.foreman.resource_info:
    server_url: "{{ server_url | default(omit) }}"
    username: "{{ username | default(omit) }}"
    password: "{{ password | default(omit) }}"
    validate_certs: "{{ validate_certs | default(omit) }}"
    organization: "{{ organization }}"
    resource: content_view_versions
    params:
      content_view_id: "{{ cv.id }}"
  register: versions

- name: "delete unused content view versions of {{ cv.name }}"
  include_tasks: delete_cv_versions.yml
  vars:
    cv_name: "{{ cv.name }}"
    cv_versions: "{{ versions | json_query(content_view_version_cleanup_cv_versions_filter) }}"
  when: versions | json_query(content_view_version_cleanup_cv_versions_filter)
