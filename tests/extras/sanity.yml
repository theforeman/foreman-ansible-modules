---
# this playbook runs `ansible-test sanity` against our collection
# we run it with --local as we are already in a working venv and making ansible-test setup one too is just a waste of time
# it skips the following tests:
# * import -- seems to be broken for collections at the moment
#             and also modifies the venv which breaks sphinx later
# * pylint -- we're not yet there
# * validate-modules -- also too many errors
- hosts: fixtures
  tasks:
    - name: Run ansible-test
      command: "ansible-test sanity --local --python {{ lookup('env', 'TRAVIS_PYTHON_VERSION') | default(ansible_python_version.split('.')[:2] | join('.'), true) }} --skip-test import --skip-test validate-modules plugins/"
      args:
        chdir: "{{ test_collection_path }}"
...
